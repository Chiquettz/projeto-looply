<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trilhas - Looply</title>
<link rel="stylesheet" href="style.css">

</head>
<body>
<!-- NAV -->
<nav>
  <div class="nav-logo" onclick="goTo('landing')">
    <img class="logo-img" src="imgs/looply-logo.png" alt="Looply">
  </div>
  <div class="nav-links">
    <button class="nav-link" id="nl-home" onclick="goTo('landing')">InÃ­cio</button>
    <button class="nav-link" id="nl-trails" onclick="reqTrails()">Trilhas</button>
    <button class="nav-link" id="nl-profile" style="display:none" onclick="goTo('profile')">Meu Perfil</button>
  </div>
  <div class="nav-right">
    <div class="xp-badge" id="xp-badge" style="display:none">
      <div class="xp-dot"></div><span id="xp-disp">0 XP</span>
    </div>
    <button class="theme-btn" id="tbtn" onclick="toggleTheme()">ğŸŒ™</button>
    <button class="btn-sm" id="btn-login" onclick="openAuth('login')">Entrar</button>
    <button class="btn-outline" id="btn-signup" onclick="openAuth('signup')">Cadastrar</button>
    <button class="btn-sm" id="btn-logout" style="display:none" onclick="logout()">Sair</button>
    <button class="hamburger" id="hbg" onclick="toggleMenu()"><span></span><span></span><span></span></button>
  </div>
</nav>

<!-- MOBILE MENU -->
<div class="mob-menu" id="mob-menu">
  <button class="nav-link" onclick="goTo('landing');closeMenu()">ğŸ  InÃ­cio</button>
  <button class="nav-link" onclick="reqTrails();closeMenu()">ğŸŒ¿ Trilhas</button>
  <button class="nav-link" id="ml-profile" style="display:none" onclick="goTo('profile');closeMenu()">ğŸ‘¤ Meu Perfil</button>
  <div class="mob-divider"></div>
  <div class="mob-btns" id="m-auth">
    <button class="btn-outline" onclick="openAuth('login');closeMenu()">Entrar</button>
    <button class="btn-sm" onclick="openAuth('signup');closeMenu()">Cadastrar</button>
  </div>
  <div class="mob-btns" id="m-user" style="display:none">
    <div class="xp-badge"><div class="xp-dot"></div><span id="m-xp">0 XP</span></div>
    <button class="btn-outline" onclick="logout()">Sair</button>
  </div>
</div>

<!-- AUTH OVERLAY -->
<div class="overlay" id="auth-ov">
  <div class="modal">
    <button class="modal-x" onclick="closeAuth()">âœ•</button>
    <div class="modal-logo"><img class="logo-img" src="logo.png" alt="Looply"></div>
    <div id="auth-content"></div>
  </div>
</div>

<div class="overlay" id="checkout-ov">
  <div class="modal">
    <button class="modal-x" onclick="document.getElementById('checkout-ov').classList.remove('open')">âœ•</button>
    <h3 style="color:var(--amber); margin-bottom: 0.5rem;">Desbloquear Premium </h3>
    <p class="modal-sub" style="margin-bottom: 1.5rem;">Acesse 3 novas trilhas exclusivas e um Game interativo.</p>
    
    <div style="background:var(--inp); padding:1.2rem; border-radius:10px; border:1px solid var(--border); margin-bottom:1.5rem;">
      <div style="display:flex; justify-content:space-between; color:var(--muted); font-size:0.9rem; margin-bottom:0.5rem;"><span>Assinatura VitalÃ­cia</span><span>R$ 29,90</span></div>
      <div style="display:flex; justify-content:space-between; color:var(--green); font-size:1.1rem; font-weight:800; border-top:1px dashed var(--border); padding-top:0.5rem;"><span>Total a Pagar</span><span>R$ 29,90</span></div>
    </div>
    
    <label style="display:flex; align-items:flex-start; gap:0.6rem; font-size:0.8rem; color:var(--muted); cursor:pointer; margin-bottom:1.5rem;">
      <input type="checkbox" id="chk-terms" onchange="togglePayBtn()">
      Li e aceito os Termos de Uso e PolÃ­tica de Privacidade. ReconheÃ§o o valor Ãºnico cobrado para liberaÃ§Ã£o.
    </label>
    
    <button class="btn-full" id="btn-pay" style="opacity:0.5; cursor:not-allowed;" disabled onclick="processPayment()">Confirmar Pagamento Seguro</button>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<div class="pg-pad">
  <div class="pg-hdr">
    <h2>Trilhas de Conhecimento</h2>
    <p>Escolha uma trilha e inicie sua jornada sustentÃ¡vel.</p>
  </div>
  <div class="trails-grid" id="trails-grid"></div>
</div>

<script src="data.js"></script>
<script src="app.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const e = document.getElementById('nl-trails'); if(e) e.classList.add('active');
  renderTrails();
});

function renderTrails() {
  if (!currentUser) { goTo('landing'); return; }
  const s = getState();
  
  const freeTrails = trails.filter(t => !t.premium);
  const premTrails = trails.filter(t => t.premium);
  
  let freeCompleted = 0;


  const freeHtml = freeTrails.map(t => {
    const ts = s.trails[t.id] || {completed:[],xpEarned:0};
    const done = ts.completed.length;
    if (done === t.activities.length) freeCompleted++;
    const pct = Math.round((done/t.activities.length)*100);
    return `<div class="trail-card" onclick="openTrail('${t.id}')">
      <div class="t-tag">${t.tag}</div>
      <h3>${t.icon} ${t.title}</h3>
      <p>${t.desc}</p>
      <div class="t-pbar"><div class="t-pfill" style="width:${pct}%"></div></div>
      <div class="t-foot"><span>${done}/${t.activities.length} atividades</span><span class="t-xp">+${t.totalXP} XP</span></div>
    </div>`;
  }).join('');
  
 
  let premHtml = premTrails.map(t => {
    const ts = s.trails[t.id] || {completed:[],xpEarned:0};
    const done = ts.completed.length;
    const pct = Math.round((done/t.activities.length)*100);
    return `<div class="trail-card" onclick="openTrail('${t.id}')">
      <div class="t-tag" style="background:var(--amber); color:#000;">Premium </div>
      <h3>${t.icon} ${t.title}</h3>
      <p>${t.desc}</p>
      <div class="t-pbar"><div class="t-pfill" style="width:${pct}%"></div></div>
      <div class="t-foot"><span>${done}/${t.activities.length} atividades</span><span class="t-xp">+${t.totalXP} XP</span></div>
    </div>`;
  }).join('');
  
  premHtml += `<div class="trail-card" style="border:2px dashed var(--amber);" onclick="goTo('game')">
      <div class="t-tag" style="background:#7c3aed; color:#fff;">Arcade </div>
      <h3>ğŸ® Recicle Certo</h3>
      <p>Mini-game cronometrado: Arraste o lixo para a lixeira correta para ganhar combos e muito XP!</p>
      <div class="t-foot"><span class="t-xp">XP Ilimitado!</span></div>
    </div>`;

 
  const isPrem = s.isPremium;

  document.getElementById('trails-grid').innerHTML = `
    <h3 style="grid-column: 1/-1; color: var(--green); margin-bottom: -0.5rem; margin-top: 1rem;">Trilhas Gratuitas</h3>
    ${freeHtml}
    
    <h3 style="grid-column: 1/-1; color: var(--amber); margin-bottom: -0.5rem; margin-top: 2rem;">Ãrea Premium</h3>
    <div style="grid-column: 1/-1; position: relative;">
      <div class="trails-grid" style="padding:0; margin:0; width:100%;">
        ${premHtml}
      </div>
      
      ${!isPrem ? `
        <div style="position:absolute; inset:0; background:var(--overlay); backdrop-filter:blur(8px); display:flex; flex-direction:column; align-items:center; justify-content:center; border-radius:18px; text-align:center; padding:2rem; z-index:10;">
          ${freeCompleted >= 5 
            ? `<h3 style="font-family:'Nunito',sans-serif; font-size:1.6rem; color:var(--amber);">ğŸŒŸ VocÃª Ã© elegÃ­vel!</h3><p style="margin-bottom:1.5rem;">VocÃª concluiu as 5 trilhas gratuitas e desbloqueou a chance de assinar o Premium!</p><button class="btn-primary" onclick="openCheckout()">Assinar Premium (R$ 29,90)</button>`
            : `<h3 style="font-family:'Nunito',sans-serif; font-size:1.6rem;">ğŸ”’ Ãrea Premium</h3><p style="margin-bottom:1.5rem;">Complete 5 trilhas gratuitas para ter o direito de assinar o plano premium. (${freeCompleted}/5 concluÃ­das)</p><button class="btn-primary" style="opacity:0.5; cursor:not-allowed;" disabled>Assinar Premium</button>`
          }
        </div>
      ` : ''}
    </div>
  `;
}

function openTrail(id) {
  const s = getState();
  const trail = trails.find(t => t.id === id);
  if (trail.premium && !s.isPremium) return; // SeguranÃ§a extra
  goTo('trail-detail', id);
}

// LÃ“GICA DO PAGAMENTO
function openCheckout() {
  document.getElementById('chk-terms').checked = false;
  togglePayBtn();
  document.getElementById('checkout-ov').classList.add('open');
}

function togglePayBtn() {
  const isChecked = document.getElementById('chk-terms').checked;
  const btn = document.getElementById('btn-pay');
  if(isChecked) { btn.disabled = false; btn.style.opacity = '1'; btn.style.cursor = 'pointer'; }
  else { btn.disabled = true; btn.style.opacity = '0.5'; btn.style.cursor = 'not-allowed'; }
}

function processPayment() {
  const btn = document.getElementById('btn-pay');
  btn.textContent = "Processando pagamento...";
  btn.disabled = true;
  
  setTimeout(() => {
    const s = getState();
    s.isPremium = true;
    saveState(s);
    document.getElementById('checkout-ov').classList.remove('open');
    showToast('ğŸŒŸ Pagamento Aprovado! Bem-vindo ao Premium!');
    renderTrails();
  }, 2000);
}
</script>
</body></html>